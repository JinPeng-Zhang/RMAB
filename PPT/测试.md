## 测试各模块功能实现

- [x] WITTLE_INDEX_CLASS.PY
  - [x] wittle_index
  - [x] W_fair_drop
  - [x] MDP
  - [x] burst(v1~v4)
  - [x] performance
- [x] configure API.py
  - [x] CONFIGURE
- [x] simulation_zip.py
  - [x] queue_simulation



## 联调

- [x] SP+burst_v1+数据采集+经验池收集
- [x] MAX_QUEUE_LEN+burst_v1+数据采集+经验池收集+WITTLE计算+WITTLE配置
- [x] SP+burst_v2+数据采集+经验池收集+WITTLE计算+WITTLE配置
- [x] MAX_QUEUE_LEN+burst_v2+数据采集+经验池收集+WITTLE计算+WITTLE配置
- [x] SP+burst_v3+数据采集+经验池收集+WITTLE计算+WITTLE配置
- [x] MAX_QUEUE_LEN+burst_v3+数据采集+经验池收集+WITTLE计算+WITTLE配置
- [x] SP+burst_v4+数据采集+经验池收集+WITTLE计算+WITTLE配置
- [x] MAX_QUEUE_LEN+burst_v4+数据采集+经验池收集+WITTLE计算+WITTLE配置
- [x] WITTLE+burst_v4+数据采集+经验池收集+WITTLE计算+WITTLE配置
- [x] WITTLE+burst_v4+数据采集+经验池收集+WITTLE计算+WITTLE配置+长时间（来包率变化）

## 联调测试过程出现的问题

1. WITTLE计算过程出现不收敛的情况，一直无法满足接受条件
   1. 不收敛的情况有两种，一个是每更新一次WITTLE，Q值也更新一次，此时对应WITTLE的Q值还没收敛，造成WITTLE和Q最后在小范围内稳定震荡。但是增加Q更新的频率后，发现该情况虽然减少很多，但还是存在。最终WITTLE在小范围内跳动，无法满足结束条件（前后变化值小于0.001），对此忽略该小范围值带来的影响，设置迭代最大次数。
   2. 如想要彻底解决该情况，可以参考QWIC算法的WITTLE计算方式，现根据其范围离散化，后学习出最优的离散值
2. 队列总是无法达到某公平性范围的状态，因而没有样本计算WITTLE
   1. 测试不同的来包率和突发情况，只要样本多，总会出现
   2. 同时对于未出现的状态，对应转移矩阵所在行不使用默认值，改行采用上次转移矩阵的值P' = P_old[row]，其他行对应更新P'[row] = 0.8*P_old[row]+0.2P_new[row]
   3. 若样本无法满足统计需要，可以根据其他状态转移的概率计算未出现状态的转移概率
3. WITTLE结果随着队列长度先增后减
   1. 这个和之前建模情况问题一致，在丢包加入惩罚后能够解决，但同时可能会增大状态空间，qlen尺度上引入丢包状态，[空队列,qlen,丢包]，但是比较WITTLE只根据QLEN
4. 优先级最大的队列，qlen=0时WITTLE值大于其他队列qlen!=0时WITLLE值，这导致其他队列累积到一定长度才开始调度。
   1. 每次调度看qlen是否等于0，如果qlen=0,则调度WITTLE次大的队列，若次大队列qlen依然为0，则继续找直至qlen不为0


## 性能测试

- [x] WITTLE+burst_v4+数据采集+经验池收集+WITTLE计算+WITTLE配置+长时间
- [x] SP+burst_v4+数据采集+经验池收集+WITTLE计算+WITTLE配置+长时间
- [x] 新增调度算法+burst_v4+数据采集+经验池收集+WITTLE计算+WITTLE配置+长时间

### 性能指标

ECN标记率

丢包率

不同优先级平均队列长度

端口的性能统计在performance字典里面

### 性能统计区间

全部仿真时间

```
performance_update_flag = True
```

### 参数设计

使用突发json脚本自动生成,v4版本

默认突发流量占端口带宽的2%，公平性指标0.4，ecn指标0.4,drop指标0.2

设置占比从2%->20%，每次增加5%

公平性指标从0.4->0.1，每次减少0.1，ecn指标每次增加0.1，drop指标固定0.2

初始化WITTLE转移矩阵使用ptran.py中的转移矩阵

仿真循环次数约为10^7，WITTLE更新频率约为10^6/次

不需要日志打印，print_log = False

每次仿真开始前清除缓存池（提前在其他位置备份一下，以便后期统计数据），exp_erase = True

### 瞬时性能统计

```
self.performance_time = 
{'time':0,'drop':[],'ecn':[],'len':[],'out':[],'out_num':[],'in_burst':[]}
```

SP（1，0，0）

{'len': 0.03659853353764829, 'drop': 0.0, 'ecn': 8.32583861762264e-06, 'time': 3000000}
{'len': 0.17364084034027205, 'drop': 3.3307999194239095e-07, 'ecn': 0.000556076586530644, 'time': 3000000}
{'len': 0.21504862544498962, 'drop': 1.3978763450206795e-05, 'ecn': 0.0016201740328216573, 'time': 3000000}
{'len': 0.23194752337996996, 'drop': 1.0905647076454123e-05, 'ecn': 0.0016341452279907192, 'time': 3000000}
{'len': 1.0215023237318765, 'drop': 0.0036836073593241162, 'ecn': 0.008734724959636793, 'time': 3000000}
{'len': 2.09514010625918, 'drop': 0.011504181801339343, 'ecn': 0.018330473872877957, 'time': 3000000}
{'len': 1.991225340164322, 'drop': 0.0014271915009552306, 'ecn': 0.006221136938047046, 'time': 3000000}
{'len': 3.098336193770781, 'drop': 0.003470654375649605, 'ecn': 0.008517111038761276, 'time': 3000000}
8.863439486629039 0.0201108525277869 0.04562216849528372

1.0 1.0 1.0 44404 734830 220767

[0.23277214186832307, 0.34691456104954776, 13.0022247565318, 16.895118691997247, 6.235169116047118, 15.766543168101434, 8.08806999658162, 6.099483125290446]

([0.9999818152972771, 0.9950068588267303, 0.9818183549348076, 0.9684530290327236, 0.7565537444026218, 0.6560816681679248, 0.7281520412478337, 0.6701901005404987])

6.756237612450418

-----------------------------------------------------------------------------------------------------------------------------------------------------------

old_WT(0.2 0.6 0.2)

{'len': 0.33806807174712716, 'drop': 0.0, 'ecn': 0.0007650465323793002, 'time': 3000000}
{'len': 0.5738904478176428, 'drop': 0.0, 'ecn': 0.0018174995405500216, 'time': 3000000}
{'len': 0.7080998986535949, 'drop': 0.0, 'ecn': 0.003401098997103737, 'time': 3000000}
{'len': 0.8059202204296353, 'drop': 1.835726140589623e-05, 'ecn': 0.0026560711465612595, 'time': 3000000}
{'len': 1.7285215549045376, 'drop': 0.00019311197322935454, 'ecn': 0.014259963887978526, 'time': 3000000}
{'len': 3.05604733046329, 'drop': 0.0014845316487927776, 'ecn': 0.03655639733090997, 'time': 3000000}
{'len': 2.9208605535601446, 'drop': 0.0006481505814998316, 'ecn': 0.008271254496037035, 'time': 3000000}
{'len': 4.179352610951553, 'drop': 0.0019093107940687205, 'ecn': 0.012548255122637905, 'time': 3000000}
14.310760688527527 0.004253462258996581 0.08027558705415776

0.22025416793554928 0.998989804785031 0.13957145821625594 44404 667437 288160

[2.5490295122060003, 5.98556740047716, 8.920377925689788, 11.185464719051645, 6.065410608437576, 17.231361571322946, 8.059843073246945, 6.608119170018933]

[0.9924442077767274, 0.9805436812666185, 0.9253923011934336, 0.9106094877425102, 0.8403378707393006, 0.6767052340157677, 0.7086794638111367, 0.6434466415214561]

6.6781588880669505

-----------------------------------------------------------------------------------------------------------------------------------------------------------

new_WI(0.5 0.3 0.2  q7)

{'len': 0.1310338870025336, 'drop': 0.0, 'ecn': 8.032847760107565e-05, 'time': 3000000}
{'len': 0.320942035185318, 'drop': 0.0, 'ecn': 0.00023866828529063745, 'time': 3000000}
{'len': 0.36194402941412485, 'drop': 4.2379108915171705e-08, 'ecn': 0.001086602649818344, 'time': 3000000}
{'len': 0.42281666030882215, 'drop': 4.4283373050741644e-07, 'ecn': 0.002043079887538175, 'time': 3000000}
{'len': 1.200995575753988, 'drop': 0.00021546464051665305, 'ecn': 0.010878136052912147, 'time': 3000000}
{'len': 2.4558293506580626, 'drop': 0.007534455788930274, 'ecn': 0.02473350284620841, 'time': 3000000}
{'len': 2.3495064731681525, 'drop': 0.0015412791604744033, 'ecn': 0.006580382879563085, 'time': 3000000}
{'len': 3.5642198932307094, 'drop': 0.003903749812199535, 'ecn': 0.009238036722373189, 'time': 3000000}
10.807287904721711 0.013195434614960288 0.05487873780130506

0.45123912929792104 0.9986574178655279 0.5119053606747909 44404 706964 248633

[2.550349390833878, 3.9243509978755444, 5.917942553870298, 16.65015791512943, 6.185131584892899, 16.212860518741184, 7.891878248890581, 6.080749382380668]

 [0.9998053584457708, 0.9932635656626486, 0.9785755844386401, 0.9477880898977805, 0.8526541815652035, 0.662513486201672, 0.7204513034805601, 0.6610994233034679]

6.816150992995744

-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

MAX_QUEUE_LEN（0,1,0） 

{'len': 1.7828876379291527, 'drop': 3.865226706029703e-05, 'ecn': 0.004611419566383484, 'time': 3000000}
{'len': 2.057330657007132, 'drop': 0.00012664747886354481, 'ecn': 0.013778719833085146, 'time': 3000000}
{'len': 1.986480894043815, 'drop': 0.0001394352539935389, 'ecn': 0.010214461189334573, 'time': 3000000}
{'len': 1.7541718400381385, 'drop': 8.294037716451334e-05, 'ecn': 0.0040884767306215595, 'time': 3000000}
{'len': 2.109551296793237, 'drop': 0.00034672919703706076, 'ecn': 0.01680113227519079, 'time': 3000000}
{'len': 2.20036367331644, 'drop': 0.0007719871703626974, 'ecn': 0.02313123946625956, 'time': 3000000}
{'len': 1.8144675737920786, 'drop': 0.0003835381839772618, 'ecn': 0.0047804213856249755, 'time': 3000000}
{'len': 1.8741115931257082, 'drop': 0.000413668140058637, 'ecn': 0.005966788627560234, 'time': 3000000}
15.579365166045703 0.002303598068517551 0.08337265907406033

0.08248020074823403 0.05389821862241285 0.05099716309046275 44404 672895 282702

[4.600822324315407, 7.552678651966363, 10.818744577473531, 10.490012270539225, 6.028369443673674, 10.094522445399496, 7.931695422078764, 5.986506949890921]



[0.9168562879044972, 0.8884286394674146, 0.8636303776739894, 0.8419763161612042, 0.8113735258381288, 0.7777205710380837, 0.758103105328245, 0.7348728968065952]

6.592961720218159

-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

9B ecn drop reward

0-3B

[0.0009236781080026105, 0.0021792931067066887, 0.004104481569382003, 0.0030523043398774964, 0.01646460905679027, 0.03964828667966049, 0.008849680335582689, 0.012826019483138527]

 [0.0, 0.0, 0.0, 1.8965172407109306e-05, 0.00023181471159186337, 0.0018703809974960218, 0.0008150553607730267, 0.002517882327364537]

[0.9994543557609366, 0.9935591842323167, 0.9632273984086205, 0.9390988615865493, 0.9108147966133426, 0.8364851043682667, 0.7832127063256299, 0.7328190803072427]

3-6B

[0.0002944169460289353, 0.0003706265622030041, 0.001779073128809812, 0.002367422299652195, 0.0026567262961922863, 0.0036039117928055703, 0.015947026919864278, 0.01669375648288584] 

[0.0, 0.0, 2.6973591911728764e-07, 5.7193375011626273e-08, 4.087500220101407e-06, 4.503394602976086e-05, 0.00015926155114611595, 0.0024121521595400672]

[0.9999161803858609, 0.9963209243891669, 0.9929606971570747, 0.9503286010403581, 0.9227308997242446, 0.9052608104736851, 0.8731880828575724, 0.8037757091517156]

6-9B

[0.0006312878357316183, 0.0007909979565799218, 0.00275049212121992, 0.0028044808214577445, 0.003024295275005143, 0.003907972478816691, 0.01766869873132493, 0.02023904962717861] 

[3.9587467251065055e-05, 2.23133780788362e-06, 6.008665095470083e-05, 0.0002377041404077572, 0.00019436703163874688, 0.00014728264368968875, 6.531592672643308e-05, 1.294789120287681e-05]

[0.9989861791171357, 0.9951406460145936, 0.9909865969886473, 0.9485079807623616, 0.9196156089671992, 0.9011213804236325, 0.8672434401544405, 0.7990876200317593]
