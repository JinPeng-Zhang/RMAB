```
3/18

引入丢包状态

需要修改class W_fair_ecn_drop()中file_exp_to_ptran函数
```

增加每一个时刻交换机端口信息显示

```
self.performance_time = 
{'time':0,'drop':[],'ecn':[],'len':[],'out':-1,'SP_flag':0,'in_burst':0}
```

修改WITTLE调度BUG

```
    def WITTLE_algorithm(self,surplus):
        q = 0
        while self.queue[q]==0 :
            q = q+1
            if q==8:
                return 0,0
        WI = self.WITTLE[q][self.EXP_cache['q{}'.format(q)][0]]
        for _q in range(q+1,8):
            if self.WITTLE[_q][self.EXP_cache[f'q{_q}'][0]]>WI:
                WI = self.WITTLE[_q][self.EXP_cache[f'q{_q}'][0]]
                q = _q
        return q,min(self.queue[q],surplus)
```

每次不充分调度后，没有把原先调度队列排除在外。





v2突发需要对突发队列进行检验

```
elif self.burst['b'][0]['type'] == 'v2':
    if times>=self.burst['b'][0]['data'][0] and times<self.burst['b'][0]['data'][1] :
        bcome = 1.5 * np.random.normal(loc=1, scale=0.2, size=None) / len(self.burst['b'][0]['data'][2:])
    elif times>=self.burst['b'][0]['data'][1]:
        self.burst['b'].pop(0)
        self.burst['len'] = self.burst['len'] - 1
```

修改条件

```
elif self.burst['b'][0]['type'] == 'v2':
    if times>=self.burst['b'][0]['data'][0] and times<self.burst['b'][0]['data'][1] and (q in self.burst['b'][0]['data'][2:]):
        bcome = 1.5 * np.random.normal(loc=1, scale=0.2, size=None) / len(self.burst['b'][0]['data'][2:])
    elif times>=self.burst['b'][0]['data'][1]:
        self.burst['b'].pop(0)
        self.burst['len'] = self.burst['len'] - 1
```

v3突发时间进行判断

```
tim = tim+t2_t1修改为
tim = start_time+t2_t1
```

丢包经验上传修改：

```
	DROP.append(drop)
if times!=0:
	self.drop_Collect(times,DROP)

def drop_Collect(self, times, drop):
    data = {'TIME': times, 'TYPE': 'D', 'DATA': drop}
    self.EXP_Collect(data)

self.drop_s[int(s / fair)] = 0.8*self.drop_s[int(s / fair)]+0.2*d
```

计算由绝对值改为相对百分比例

```python
	DROP.append(drop/come)##百分比
if times!=0:
    self.drop_Collect(times,DROP)
```

丢包统计修改

```
self.drop_s[int(s / fair)] = 0.8*self.drop_s[int(s / fair)]+0.2*d
```

丢包-ECN性能统计修改

```python
self.performance_time['drop'].append(drop)
self.performance_time['ecn'].append(ecn)
```

```python
self.performance_time['drop'].append(drop/come if come != 0 else 0)
self.performance_time['ecn'].append(ecn/come if come != 0 else 0)
```

REWARD统计更改：

当发生丢包时，应认为ECN标记概率为1，而非0